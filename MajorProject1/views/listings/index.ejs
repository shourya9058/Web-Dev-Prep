<% layout("/layouts/boilerplate") %>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<link rel="stylesheet" href="/css/style.css" />
<div class="listings-container">
  <div class="filters-bar">
    <div class="category-filters">
      <div class="filter-scroll">
        <button class="filter-btn active">
          <i class="fas fa-bed"></i>
          <span>All Rooms</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-user"></i>
          <span>Single</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-users"></i>
          <span>Shared</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-couch"></i>
          <span>Furnished</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-graduation-cap"></i>
          <span>For Students</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-briefcase"></i>
          <span>For Professionals</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-venus-mars"></i>
          <span>Any Gender</span>
        </button>
        <button class="filter-btn">
          <i class="fas fa-calendar-check"></i>
          <span>Immediate</span>
        </button>
      </div>
    </div>
    <div class="filter-options">
      <button class="show-filters-btn" id="advanced-filters-btn">
        <i class="fas fa-sliders-h"></i>
        <span>More Filters</span>
      </button>
      <div class="price-toggle">
        <div class="tax-toggle-container">
          <span class="tax-toggle-label">Display total before taxes</span>
          <label class="tax-switch">
            <input type="checkbox" id="tax-toggle" />
            <span class="tax-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Filters Modal -->
  <div class="advanced-filters-modal" id="advanced-filters-modal">
    <div class="advanced-filters-content">
      <div class="modal-header">
        <h3>Filter Rooms</h3>
        <button class="close-modal-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="advanced-filter-form">
          <div class="filter-section">
            <h4>Room Type</h4>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" name="roomType" value="single" />
                Single</label
              >
              <label
                ><input type="checkbox" name="roomType" value="shared" />
                Shared</label
              >
              <label
                ><input type="checkbox" name="roomType" value="studio" />
                Studio</label
              >
            </div>
          </div>

          <div class="filter-section">
            <h4>Furnished Status</h4>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" name="furnished" value="furnished" />
                Furnished</label
              >
              <label
                ><input type="checkbox" name="furnished" value="unfurnished" />
                Unfurnished</label
              >
              <label
                ><input
                  type="checkbox"
                  name="furnished"
                  value="semifurnished"
                />
                Semi-furnished</label
              >
            </div>
          </div>

          <div class="filter-section">
            <h4>Gender Preference</h4>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" name="gender" value="male" /> Male
                Only</label
              >
              <label
                ><input type="checkbox" name="gender" value="female" /> Female
                Only</label
              >
              <label
                ><input type="checkbox" name="gender" value="any" /> Any</label
              >
            </div>
          </div>

          <div class="filter-section">
            <h4>Preferred Tenants</h4>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" name="tenants" value="students" />
                Students</label
              >
              <label
                ><input type="checkbox" name="tenants" value="professionals" />
                Working Professionals</label
              >
              <label
                ><input type="checkbox" name="tenants" value="family" />
                Family</label
              >
              <label
                ><input type="checkbox" name="tenants" value="couples" />
                Couples</label
              >
              <label
                ><input type="checkbox" name="tenants" value="any" /> Any</label
              >
            </div>
          </div>

          <div class="filter-section">
            <h4>Monthly Rent Range</h4>
            <div class="range-slider">
              <input
                type="range"
                id="min-price"
                min="1000"
                max="50000"
                step="500"
                value="1000"
              />
              <input
                type="range"
                id="max-price"
                min="1000"
                max="50000"
                step="500"
                value="50000"
              />
              <div class="price-inputs">
                <div>
                  <label for="min-price-input">Min ₹</label>
                  <input
                    type="number"
                    id="min-price-input"
                    min="1000"
                    max="50000"
                    value="1000"
                  />
                </div>
                <div>
                  <label for="max-price-input">Max ₹</label>
                  <input
                    type="number"
                    id="max-price-input"
                    min="1000"
                    max="50000"
                    value="50000"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="filter-section">
            <h4>Location</h4>
            <select name="location" class="location-select">
              <option value="">All Locations</option>
              <!-- Populate with locations from your database -->
              <option value="central">Central Area</option>
              <option value="north">North Area</option>
              <option value="south">South Area</option>
              <option value="east">East Area</option>
              <option value="west">West Area</option>
            </select>
          </div>

          <div class="filter-section">
            <h4>Availability</h4>
            <div class="radio-group">
              <label
                ><input type="radio" name="availability" value="immediate" />
                Immediate</label
              >
              <label
                ><input type="radio" name="availability" value="specific" />
                Specific Date</label
              >
              <label
                ><input type="radio" name="availability" value="any" checked />
                Any</label
              >
            </div>
            <div
              class="date-picker"
              id="specific-date-container"
              style="display: none"
            >
              <label for="available-from">Available From:</label>
              <input type="date" id="available-from" name="availableFrom" />
            </div>
          </div>

          <div class="filter-section">
            <h4>Amenities</h4>
            <div class="checkbox-group amenities-group">
              <label
                ><input
                  type="checkbox"
                  name="amenities"
                  value="attached-bathroom"
                />
                Attached Bathroom</label
              >
              <label
                ><input
                  type="checkbox"
                  name="amenities"
                  value="kitchen-access"
                />
                Kitchen Access</label
              >
              <label
                ><input type="checkbox" name="amenities" value="wifi" />
                WiFi</label
              >
              <label
                ><input type="checkbox" name="amenities" value="ac" /> Air
                Conditioning</label
              >
              <label
                ><input type="checkbox" name="amenities" value="laundry" />
                Laundry</label
              >
              <label
                ><input type="checkbox" name="amenities" value="parking" />
                Parking</label
              >
            </div>
          </div>

          <div class="filter-buttons">
            <button type="button" class="reset-btn">Reset All</button>
            <button type="submit" class="apply-btn">Apply Filters</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="row listings-grid">
    <% for(let listing of allListings) { %>
    <div
      class="col-lg-4 col-md-6 col-sm-12 listing-col"
      data-room-type="<%= listing.roomType || 'single' %>"
      data-furnished="<%= listing.furnished || 'furnished' %>"
      data-gender="<%= listing.genderPreference || 'any' %>"
      data-tenants="<%= listing.preferredTenants || 'any' %>"
      data-price="<%= listing.price %>"
      data-location="<%= listing.location || '' %>"
      data-availability="<%= listing.immediateAvailability ? 'immediate' : 'later' %>"
      data-available-from="<%= listing.availableFrom || '' %>"
    >
      <a href="/listings/<%= listing._id %>" class="listing-link">
        <div class="listing-card">
          <div class="image-carousel">
            <div class="carousel-inner">
              <!-- Main image -->
              <img
                src="<%= listing.image.url %>"
                class="carousel-img active"
                alt="<%= listing.title %>"
              />

              <!-- Additional images if available -->
              <% if(listing.images && listing.images.length > 0) { %> <%
              listing.images.forEach((img, index) => { %>
              <img
                src="<%= img.url %>"
                class="carousel-img"
                alt="<%= listing.title %> - image <%= index + 2 %>"
              />
              <% }) %> <% } %>
            </div>

            <!-- Carousel Navigation Dots -->
            <div class="carousel-dots">
              <span class="dot active" data-index="0"></span>
              <% if(listing.images && listing.images.length > 0) { %> <%
              listing.images.forEach((img, index) => { %>
              <span class="dot" data-index="<%= index + 1 %>"></span>
              <% }) %> <% } %>
            </div>

            <!-- Carousel Controls -->
            <div class="carousel-controls">
              <button class="carousel-control prev" aria-label="Previous image">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="carousel-control next" aria-label="Next image">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>

            <!-- Favorite Button -->
            <button class="favorite-btn" aria-label="Add to favorites">
              <i class="far fa-heart"></i>
            </button>
          </div>

          <div class="listing-info">
            <div class="listing-header">
              <h3 class="listing-title"><%= listing.title %></h3>
              <div class="listing-rating">
                <i class="fas fa-star"></i>
                <span><%= (listing.rating || 4.5).toFixed(1) %></span>
              </div>
            </div>
            <p class="listing-location">
              <%= listing.location || 'Beautiful location' %>
            </p>

            <div class="room-tags">
              <% if(listing.roomType) { %>
              <span class="tag room-type"><%= listing.roomType %></span>
              <% } %> <% if(listing.furnished) { %>
              <span class="tag furnished-status"><%= listing.furnished %></span>
              <% } %> <% if(listing.genderPreference) { %>
              <span class="tag gender"
                ><%= listing.genderPreference %> only</span
              >
              <% } %>
            </div>

            <p class="listing-dates">
              <% if(listing.immediateAvailability) { %>
              <span class="availability immediate">Available Now</span>
              <% } else if(listing.availableFrom) { %>
              <span class="availability"
                >Available from <%= new
                Date(listing.availableFrom).toLocaleDateString() %></span
              >
              <% } else { %>
              <span class="availability">Contact for availability</span>
              <% } %>
            </p>
            <p class="listing-price">
              <strong>₹<%= listing.price.toLocaleString("en-IN") %></strong> /
              month
            </p>
          </div>
        </div>
      </a>
    </div>
    <% } %>
  </div>

  <button class="show-map-btn">
    <span>Show map</span>
    <i class="fas fa-map-marker-alt"></i>
  </button>
</div>

<div id="map-modal" class="map-modal">
  <div class="map-modal-content">
    <div class="map-modal-header">
      <h3>Property Locations</h3>
      <button class="close-map-btn">&times;</button>
    </div>
    <div class="map-container">
      <div id="listings-map"></div>
    </div>
    <div class="map-listings-sidebar">
      <h4>Nearby Listings</h4>
      <div class="map-listings-container">
        <!-- Map listing items will be populated here dynamically -->
      </div>
    </div>
  </div>
</div>
<script src="/init/data.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="/js/room-filters.js"></script>
<script src="/js/script.js"></script>
